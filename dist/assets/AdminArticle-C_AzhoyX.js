import{m as y}from"./modalMixins-DdrMPlSF.js";import{_ as P,o as d,c as r,b as t,y as p,z as h,F as f,v as $,e as A,t as _,I as x,d as g,r as v,f as M}from"./index-CoW_epj6.js";import{V}from"./VueLoading-61m2rGh4.js";var T={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"david555",BASE_URL:"/vue3-OptionAPi-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:k,VITE_APP_PATH:E}=T,U={props:{article:Object},data(){return{modal:null,tempArticle:{isPublic:!0},tags:["漢堡","披薩","飲料","牛排","沙拉"]}},methods:{updateArticle(){const l=Math.floor(Date.now()/1e3);this.tempArticle.create_at=l,this.$emit("update-article",this.tempArticle)},uploadFile(){const l=this.$refs.fileInput.files[0],e=new FormData;e.append("up-load-file",l);const a=`${k}/api/${E}/admin/upload`;this.$http.post(a,e,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{o.data.success&&(this.tempArticle.image=o.data.imageUrl)}).catch(o=>{o.response.data.message&&this.$swal("錯誤","無法上傳圖片","error")})},addTag(l){this.tempArticle.tag=[l]},showModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{article(){this.tempArticle={...this.article,isPublic:this.article.isPublic||!1}}},mixins:[y]},I={class:"modal fade",tabindex:"-1",ref:"myModal"},L={class:"modal-dialog modal-xl"},C={class:"modal-content"},R=t("div",{class:"modal-header bg-primary"},[t("h5",{class:"modal-title text-light"},"新增文章"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),D={class:"modal-body"},F={class:"row"},N={class:"col-12"},O={class:"row"},S={class:"col-6 mb-3"},H=t("label",{for:"title",class:"form-label"},"文章名稱",-1),B={class:"col-6"},j=t("label",{for:"author",class:"form-label"},"作者名稱",-1),z={class:"col-6 mb-3"},q=t("label",{for:"img",class:"form-label"},"請輸入圖片網址",-1),G=["src"],J={class:"col-6 mb-3"},K=t("label",{for:"tag",class:"form-label"},"標籤",-1),Q={class:"d-flex p-0 custom-btn-primary"},W=["onClick"],X={class:"col-12 mb-3"},Y=t("label",{for:"description",class:"form-label mt-3"},"文章描述",-1),Z={class:"col-12"},tt=t("label",{for:"content",class:"form-label"},"文章內容",-1),et={class:"mt-2"},st=t("label",{class:"form-check-label ms-1",for:"isPublic"},"是否公開",-1),lt={class:"modal-footer"},it=t("button",{type:"button",class:"btn btn-dark","data-bs-dismiss":"modal"}," 取消 ",-1);function ot(l,e,a,o,i,c){return d(),r("div",I,[t("div",L,[t("div",C,[R,t("div",D,[t("div",F,[t("div",N,[t("div",O,[t("div",S,[H,p(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=s=>i.tempArticle.title=s),placeholder:"請輸入文章名稱",id:"title"},null,512),[[h,i.tempArticle.title]])]),t("div",B,[j,p(t("input",{type:"text",class:"form-control",placeholder:"請輸入作者名稱",id:"author","onUpdate:modelValue":e[1]||(e[1]=s=>i.tempArticle.author=s)},null,512),[[h,i.tempArticle.author]])]),t("div",z,[q,p(t("input",{type:"text",class:"form-control mb-3",placeholder:"請輸入圖片網址",id:"img","onUpdate:modelValue":e[2]||(e[2]=s=>i.tempArticle.image=s)},null,512),[[h,i.tempArticle.image]]),t("input",{type:"file",name:"file-to-upload",id:"customFile",onChange:e[3]||(e[3]=(...s)=>c.uploadFile&&c.uploadFile(...s)),ref:"fileInput",class:"form-control mb-3"},null,544),t("img",{src:i.tempArticle.image,class:"w-25 h-50 object-fit-cover",alt:"article-modal-img"},null,8,G)]),t("div",J,[K,t("ul",Q,[(d(!0),r(f,null,$(i.tags,s=>(d(),r("li",{key:s},[t("button",{class:"btn me-2",type:"button",onClick:A(b=>c.addTag(s),["prevent"])},_(s),9,W)]))),128))])]),t("div",X,[Y,p(t("input",{type:"text",class:"form-control",placeholder:"請輸入文章描述",id:"description","onUpdate:modelValue":e[4]||(e[4]=s=>i.tempArticle.description=s)},null,512),[[h,i.tempArticle.description]])]),t("div",Z,[tt,p(t("textarea",{name:"",id:"",cols:"30",rows:"10","onUpdate:modelValue":e[5]||(e[5]=s=>i.tempArticle.content=s),class:"form-control"},null,512),[[h,i.tempArticle.content]])]),t("div",et,[p(t("input",{id:"isPublic",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>i.tempArticle.isPublic=s)},null,512),[[x,i.tempArticle.isPublic]]),st])])])])]),t("div",lt,[it,t("button",{type:"button",class:"btn btn-primary",onClick:e[7]||(e[7]=(...s)=>c.updateArticle&&c.updateArticle(...s))}," 確認 ")])])])],512)}const at=P(U,[["render",ot]]);var ct={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"david555",BASE_URL:"/vue3-OptionAPi-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:m,VITE_APP_PATH:u}=ct,nt={data(){return{tempArticle:{},articles:[],isNewArticle:!1,isLoading:!1}},components:{ArticleModal:at,VueLoading:V},methods:{openArticleEditModal(l){const e=`${m}/api/${u}/admin/article/${l.id}`;this.$http.get(e).then(o=>{this.tempArticle=o.data.article,this.isNewArticle=!1}).catch(o=>{o.response.data.message&&this.$swal("錯誤","你所查看的API不存在","error")}),this.$refs.articleModal.showModal()},openArticleModal(){this.tempArticle={};const l=this.$refs.articleModal;this.isNewArticle=!0,l.showModal()},updateArticle(l){this.tempArticle=l;let e=`${m}/api/${u}/admin/article`,a="post";this.isNewArticle||(e=`${m}/api/${u}/admin/article/${this.tempArticle.id}`,a="put"),this.$http[a](e,{data:this.tempArticle}).then(o=>{o.data.success&&(this.$refs.articleModal.hideModal(),this.getArticles())}).catch(o=>{o.response.data.message&&this.$swal("錯誤","無法新增或修改產品","error")})},getArticles(){this.isLoading=!0;const l=`${m}/api/${u}/admin/articles`;this.$http.get(l).then(e=>{e.data.success&&(this.articles=e.data.articles,setTimeout(()=>{this.isLoading=!1},800))}).catch(e=>{e.response.data.message&&this.$swal("錯誤","你所查看的API不存在","error")})},delArticle(l){const e=`${m}/api/${u}/admin/article/${l.id}`;this.$http.delete(e).then(a=>{a.data.success&&this.getArticles()}).catch(a=>{a.response.data.message&&this.$swal("錯誤","刪除文章失敗","error")})}},mounted(){this.getArticles()}},dt={class:"container"},rt={class:"text-end my-md-5 my-3 custom-btn-primary"},pt={class:"table table-striped productTable"},ht=t("thead",null,[t("tr",null,[t("th",{width:"10"}),t("th",{width:"10"}),t("th",null,"標題"),t("th",null,"描述"),t("th",{width:"100"},"作者"),t("th",{width:"100"},"發布日期"),t("th",{width:"150",class:"text-center"},"狀態"),t("th",{width:"100"},"編輯")])],-1),mt={class:"pt-3"},ut=["onClick"],_t=t("i",{class:"bi bi-x h3 text-danger"},null,-1),ft=[_t],At=t("td",null,null,-1),bt=["src"],gt={class:"text-truncate d-block",style:{width:"300px"}},vt={key:0,class:"bg-success text-center activeRounded"},Pt=t("span",null,"公開",-1),$t=[Pt],wt={key:1,class:"bg-warning text-center activeRounded"},yt=t("span",null,"不公開",-1),xt=[yt],Mt=["onClick"];function Vt(l,e,a,o,i,c){const s=v("VueLoading"),b=v("ArticleModal");return d(),r(f,null,[g(s,{active:i.isLoading},null,8,["active"]),t("div",dt,[t("div",rt,[t("button",{class:"btn btn-lg",type:"button",onClick:e[0]||(e[0]=(...n)=>c.openArticleModal&&c.openArticleModal(...n))},"新增文章")]),t("table",pt,[ht,t("tbody",null,[(d(!0),r(f,null,$(i.articles,n=>(d(),r("tr",{key:n.id},[t("td",mt,[t("a",{href:"#",onClick:A(w=>c.delArticle(n),["prevent"])},ft,8,ut)]),At,t("td",null,[t("img",{class:"",width:"80",height:"50",src:n.image},null,8,bt),M(" "+_(n.title),1)]),t("td",null,[t("p",gt,_(n.description),1)]),t("td",null,_(n.author),1),t("td",null,_(l.$filters.date(n.create_at)),1),t("td",null,[n.isPublic?(d(),r("div",vt,$t)):(d(),r("div",wt,xt))]),t("td",null,[t("button",{type:"button",class:"btn btn-outline-dark",onClick:A(w=>c.openArticleEditModal(n),["prevent"])}," 編輯 ",8,Mt)])]))),128))])])]),g(b,{ref:"articleModal",article:i.tempArticle,onUpdateArticle:c.updateArticle},null,8,["article","onUpdateArticle"])],64)}const Ut=P(nt,[["render",Vt]]);export{Ut as default};
