import { m as x } from './modalMixins-gb6TmebJ.js'; import { _ as y, o as a, c as u, b as t, y as c, z as r, I as w, g as m, d as v, w as k, F as C, v as L, r as f, t as b } from './index-DrL7xUhK.js'; import { i as g } from './index-Bnm8mFos.js'; const P = { props: ['coupon'], data () { return { modal: null, tempCoupon: {}, due_date: '' } }, methods: { updateCoupon () { this.$emit('update-coupon', this.tempCoupon), this.hideModal() } }, watch: { coupon () { this.tempCoupon = this.coupon; const o = new Date(this.tempCoupon.due_date * 1e3).toISOString().split('T'); [this.due_date] = o }, due_date () { this.tempCoupon.due_date = Math.floor(new Date(this.due_date) / 1e3) } }, mixins: [x] }; const V = { class: 'modal fade', id: 'couponModal', tabindex: '-1', role: 'dialog', 'aria-labelledby': 'exampleModalLabel', 'aria-hidden': 'true', ref: 'myModal' }; const T = { class: 'modal-dialog', role: 'document' }; const U = { class: 'modal-content' }; const A = t('div', { class: 'modal-header bg-primary' }, [t('h5', { class: 'modal-title text-light', id: 'exampleModalLabel' }, '優惠券'), t('button', { type: 'button', class: 'btn-close', 'data-bs-dismiss': 'modal', 'aria-label': 'Close' })], -1); const D = { class: 'modal-body' }; const E = { class: 'mb-3' }; const S = t('label', { for: 'title' }, '標題', -1); const I = { class: 'mb-3' }; const R = t('label', { for: 'coupon_code' }, '優惠碼', -1); const B = { class: 'mb-3' }; const H = t('label', { for: 'due_date' }, '到期日', -1); const N = { class: 'mb-3' }; const q = t('label', { for: 'percent' }, '折扣百分比', -1); const O = { class: 'mb-3' }; const F = { class: 'form-check' }; const j = t('label', { class: 'form-check-label', for: 'is_enabled' }, ' 是否啟用 ', -1); const z = { class: 'modal-footer' }; const G = t('button', { type: 'button', class: 'btn btn-dark', 'data-bs-dismiss': 'modal' }, '取消', -1); function J (o, e, d, p, s, l) { return a(), u('div', V, [t('div', T, [t('div', U, [A, t('div', D, [t('div', E, [S, c(t('input', { type: 'text', class: 'form-control', id: 'title', placeholder: '請輸入標題', 'onUpdate:modelValue': e[0] || (e[0] = n => s.tempCoupon.title = n) }, null, 512), [[r, s.tempCoupon.title]])]), t('div', I, [R, c(t('input', { type: 'text', class: 'form-control', id: 'coupon_code', placeholder: '請輸入優惠碼', 'onUpdate:modelValue': e[1] || (e[1] = n => s.tempCoupon.code = n) }, null, 512), [[r, s.tempCoupon.code]])]), t('div', B, [H, c(t('input', { type: 'date', class: 'form-control', id: 'due_date', 'onUpdate:modelValue': e[2] || (e[2] = n => s.due_date = n) }, null, 512), [[r, s.due_date]])]), t('div', N, [q, c(t('input', { type: 'number', class: 'form-control', id: 'percent', placeholder: '請輸入折扣百分比', 'onUpdate:modelValue': e[3] || (e[3] = n => s.tempCoupon.percent = n) }, null, 512), [[r, s.tempCoupon.percent]])]), t('div', O, [t('div', F, [c(t('input', { class: 'form-check-input', type: 'checkbox', 'true-value': 1, 'false-value': 0, id: 'is_enabled', 'onUpdate:modelValue': e[4] || (e[4] = n => s.tempCoupon.is_enabled = n) }, null, 512), [[w, s.tempCoupon.is_enabled]]), j])])]), t('div', z, [G, t('button', { type: 'button', class: 'btn btn-primary', onClick: e[5] || (e[5] = m((...n) => l.updateCoupon && l.updateCoupon(...n), ['prevent'])) }, ' 更新優惠券 ')])])])], 512) } const K = y(P, [['render', J]]); const Q = { VITE_APP_URL: 'https://vue3-course-api.hexschool.io/v2', VITE_APP_PATH: 'david555', BASE_URL: './', MODE: 'production', DEV: !1, PROD: !0, SSR: !1 }; const { VITE_APP_URL: h, VITE_APP_PATH: _ } = Q; const W = { components: { CouponModal: K }, data () { return { tempCoupon: {}, coupons: [], isNewCoupon: !1, isLoading: !1 } }, methods: { getCoupons () { this.isLoading = !0; const o = `${h}/api/${_}/admin/coupons`; this.$http.get(o).then(e => { e.data.success && (this.coupons = e.data.coupons, setTimeout(() => { this.isLoading = !1 }, 800)) }).catch(e => { e.response.data.message && this.$swal('錯誤', '你所查看的API不存在', 'error') }) }, openCouponModal (o, e) { o ? this.tempCoupon = { due_date: new Date().getTime() / 1e3 } : this.tempCoupon = { ...e }, this.isNewCoupon = o, this.$refs.couponModal.showModal() }, updateCoupon (o) { this.tempCoupon = { ...o }; let e = `${h}/api/${_}/admin/coupon`; let d = 'post'; this.isNewCoupon || (e = `${h}/api/${_}/admin/coupon/${o.id}`, d = 'put'), this.$http[d](e, { data: this.tempCoupon }).then(p => { p.data.success && (g('更新優惠券成功', { theme: 'auto', type: 'success', autoClose: 1e3, hideProgressBar: !0, dangerouslyHTMLString: !0 }), this.getCoupons()) }).catch(p => { p.response.data.message && g('新增優惠券失敗', { theme: 'auto', type: 'error', autoClose: 1e3, hideProgressBar: !0, dangerouslyHTMLString: !0 }) }) }, delCoupon (o) { const e = `${h}/api/${_}/admin/coupon/${o.id}`; this.$http.delete(e).then(d => { d.data.success && this.getCoupons() }).catch(d => { d.response.data.message && this.$swal('刪除失敗', '請新重操作', 'error') }) } }, mounted () { this.getCoupons() } }; const X = t('div', { class: 'loadingio-spinner-spin-nq4q5u6dq7r' }, [t('div', { class: 'ldio-x2uulkbinbj' }, [t('div', null, [t('div')]), t('div', null, [t('div')]), t('div', null, [t('div')]), t('div', null, [t('div')]), t('div', null, [t('div')]), t('div', null, [t('div')]), t('div', null, [t('div')]), t('div', null, [t('div')])])], -1); const Y = { class: 'text-end my-4' }; const Z = { class: 'table mt-4 table-striped' }; const tt = t('thead', null, [t('tr', null, [t('th', { width: '100' }), t('th', { width: '300' }, '名稱'), t('th', { width: '150' }, '折扣百分比'), t('th', { width: '150' }, '到期日'), t('th', { width: '100' }, '是否啟用'), t('th', { width: '80' }, '編輯')])], -1); const et = { href: '#' }; const ot = ['onClick']; const st = { class: 'text-right' }; const nt = { key: 0, class: 'bg-success text-center activeRounded' }; const dt = t('span', null, '啟用', -1); const it = [dt]; const lt = { key: 1, class: 'bg-warning text-center activeRounded' }; const at = t('span', null, '未啟用', -1); const ut = [at]; const pt = { class: 'btn-group' }; const ct = ['onClick']; function rt (o, e, d, p, s, l) { const n = f('VueLoading'); const $ = f('CouponModal'); return a(), u(C, null, [v(n, { active: s.isLoading }, { default: k(() => [X]), _: 1 }, 8, ['active']), t('div', Y, [t('button', { type: 'button', class: 'btn btn-primary btn-lg', onClick: e[0] || (e[0] = m(i => l.openCouponModal(!0), ['prevent'])) }, ' 新增優惠券 ')]), t('table', Z, [tt, t('tbody', null, [(a(!0), u(C, null, L(s.coupons, i => (a(), u('tr', { key: i.id }, [t('td', null, [t('a', et, [t('i', { class: 'bi bi-x h3 text-danger', onClick: m(M => l.delCoupon(i), ['prevent']) }, null, 8, ot)])]), t('td', null, b(i.title), 1), t('td', null, b(i.percent), 1), t('td', st, b(o.$filters.date(i.due_date)), 1), t('td', null, [i.is_enabled ? (a(), u('div', nt, it)) : (a(), u('div', lt, ut))]), t('td', null, [t('div', pt, [t('button', { class: 'btn btn-outline-primary btn-sm', onClick: m(M => l.openCouponModal(!1, i), ['prevent']) }, ' 編輯 ', 8, ct)])])]))), 128))])]), v($, { ref: 'couponModal', coupon: s.tempCoupon, onUpdateCoupon: l.updateCoupon }, null, 8, ['coupon', 'onUpdateCoupon'])], 64) } const bt = y(W, [['render', rt]]); export { bt as default }
