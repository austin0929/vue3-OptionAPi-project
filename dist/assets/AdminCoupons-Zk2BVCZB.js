import { m as x } from './modalMixins-BlWN4yH2.js'; import { _ as y, o as l, c as p, b as t, y as c, z as r, I as k, d as b, F as C, v as w, r as f, g as v, t as m } from './index-z9VVAXen.js'; import { i as g } from './index-CwHr2tNN.js'; import { V } from './VueLoading-DTgNEhzE.js'; const L = { props: ['coupon'], data () { return { modal: null, tempCoupon: {}, due_date: '' } }, methods: { updateCoupon () { this.$emit('update-coupon', this.tempCoupon), this.hideModal() } }, watch: { coupon () { this.tempCoupon = this.coupon; const o = new Date(this.tempCoupon.due_date * 1e3).toISOString().split('T'); [this.due_date] = o }, due_date () { this.tempCoupon.due_date = Math.floor(new Date(this.due_date) / 1e3) } }, mixins: [x] }; const P = { class: 'modal fade', id: 'couponModal', tabindex: '-1', role: 'dialog', 'aria-labelledby': 'exampleModalLabel', 'aria-hidden': 'true', ref: 'myModal' }; const T = { class: 'modal-dialog', role: 'document' }; const A = { class: 'modal-content' }; const U = t('div', { class: 'modal-header bg-primary' }, [t('h5', { class: 'modal-title text-light', id: 'exampleModalLabel' }, '優惠券'), t('button', { type: 'button', class: 'btn-close', 'data-bs-dismiss': 'modal', 'aria-label': 'Close' })], -1); const D = { class: 'modal-body' }; const E = { class: 'mb-3' }; const S = t('label', { for: 'title' }, '標題', -1); const I = { class: 'mb-3' }; const R = t('label', { for: 'coupon_code' }, '優惠碼', -1); const B = { class: 'mb-3' }; const H = t('label', { for: 'due_date' }, '到期日', -1); const N = { class: 'mb-3' }; const O = t('label', { for: 'percent' }, '折扣百分比', -1); const F = { class: 'mb-3' }; const j = { class: 'form-check' }; const z = t('label', { class: 'form-check-label', for: 'is_enabled' }, ' 是否啟用 ', -1); const q = { class: 'modal-footer' }; const G = t('button', { type: 'button', class: 'btn btn-dark', 'data-bs-dismiss': 'modal' }, '取消', -1); function J (o, e, d, u, s, a) { return l(), p('div', P, [t('div', T, [t('div', A, [U, t('div', D, [t('div', E, [S, c(t('input', { type: 'text', class: 'form-control', id: 'title', placeholder: '請輸入標題', 'onUpdate:modelValue': e[0] || (e[0] = n => s.tempCoupon.title = n) }, null, 512), [[r, s.tempCoupon.title]])]), t('div', I, [R, c(t('input', { type: 'text', class: 'form-control', id: 'coupon_code', placeholder: '請輸入優惠碼', 'onUpdate:modelValue': e[1] || (e[1] = n => s.tempCoupon.code = n) }, null, 512), [[r, s.tempCoupon.code]])]), t('div', B, [H, c(t('input', { type: 'date', class: 'form-control', id: 'due_date', 'onUpdate:modelValue': e[2] || (e[2] = n => s.due_date = n) }, null, 512), [[r, s.due_date]])]), t('div', N, [O, c(t('input', { type: 'number', class: 'form-control', id: 'percent', placeholder: '請輸入折扣百分比', 'onUpdate:modelValue': e[3] || (e[3] = n => s.tempCoupon.percent = n) }, null, 512), [[r, s.tempCoupon.percent]])]), t('div', F, [t('div', j, [c(t('input', { class: 'form-check-input', type: 'checkbox', 'true-value': 1, 'false-value': 0, id: 'is_enabled', 'onUpdate:modelValue': e[4] || (e[4] = n => s.tempCoupon.is_enabled = n) }, null, 512), [[k, s.tempCoupon.is_enabled]]), z])])]), t('div', q, [G, t('button', { type: 'button', class: 'btn btn-primary', onClick: e[5] || (e[5] = (...n) => a.updateCoupon && a.updateCoupon(...n)) }, '更新優惠券')])])])], 512) } const K = y(L, [['render', J]]); const Q = { VITE_APP_URL: 'https://vue3-course-api.hexschool.io/v2', VITE_APP_PATH: 'david555', BASE_URL: '/vue3-OptionAPi-project/', MODE: 'production', DEV: !1, PROD: !0, SSR: !1 }; const { VITE_APP_URL: h, VITE_APP_PATH: _ } = Q; const W = { components: { CouponModal: K, VueLoading: V }, data () { return { tempCoupon: {}, coupons: [], isNewCoupon: !1, isLoading: !1 } }, methods: { getCoupons () { this.isLoading = !0; const o = `${h}/api/${_}/admin/coupons`; this.$http.get(o).then(e => { e.data.success && (this.coupons = e.data.coupons, setTimeout(() => { this.isLoading = !1 }, 800)) }).catch(e => { e.response.data.message && this.$swal('錯誤', '你所查看的API不存在', 'error') }) }, openCouponModal (o, e) { o ? this.tempCoupon = { due_date: new Date().getTime() / 1e3 } : this.tempCoupon = { ...e }, this.isNewCoupon = o, this.$refs.couponModal.showModal() }, updateCoupon (o) { this.tempCoupon = { ...o }; let e = `${h}/api/${_}/admin/coupon`; let d = 'post'; this.isNewCoupon || (e = `${h}/api/${_}/admin/coupon/${o.id}`, d = 'put'), this.$http[d](e, { data: this.tempCoupon }).then(u => { u.data.success && (g('更新優惠券成功', { theme: 'auto', type: 'success', autoClose: 1e3, hideProgressBar: !0, dangerouslyHTMLString: !0 }), this.getCoupons()) }).catch(u => { u.response.data.message && g('新增優惠券失敗', { theme: 'auto', type: 'error', autoClose: 1e3, hideProgressBar: !0, dangerouslyHTMLString: !0 }) }) }, delCoupon (o) { const e = `${h}/api/${_}/admin/coupon/${o.id}`; this.$http.delete(e).then(d => { d.data.success && this.getCoupons() }).catch(d => { d.response.data.message && this.$swal('刪除失敗', '請新重操作', 'error') }) } }, mounted () { this.getCoupons() } }; const X = { class: 'text-end my-md-5 my-3 custom-btn-primary' }; const Y = { class: 'table mt-4 table-striped' }; const Z = t('thead', null, [t('tr', null, [t('th', { width: '100' }), t('th', { width: '300' }, '名稱'), t('th', { width: '150' }, '折扣百分比'), t('th', { width: '150' }, '到期日'), t('th', { width: '100' }, '是否啟用'), t('th', { width: '80' }, '編輯')])], -1); const tt = { href: '#' }; const et = ['onClick']; const ot = { class: 'text-right' }; const st = { key: 0, class: 'bg-success text-center activeRounded' }; const nt = t('span', null, '啟用', -1); const dt = [nt]; const it = { key: 1, class: 'bg-warning text-center activeRounded' }; const at = t('span', null, '未啟用', -1); const lt = [at]; const pt = { class: 'btn-group' }; const ut = ['onClick']; function ct (o, e, d, u, s, a) { const n = f('VueLoading'); const $ = f('CouponModal'); return l(), p(C, null, [b(n, { active: s.isLoading }, null, 8, ['active']), t('div', X, [t('button', { type: 'button', class: 'btn btn-lg', onClick: e[0] || (e[0] = i => a.openCouponModal(!0)) }, '新增優惠券')]), t('table', Y, [Z, t('tbody', null, [(l(!0), p(C, null, w(s.coupons, i => (l(), p('tr', { key: i.id }, [t('td', null, [t('a', tt, [t('i', { class: 'bi bi-x h3 text-danger', onClick: v(M => a.delCoupon(i), ['prevent']) }, null, 8, et)])]), t('td', null, m(i.title), 1), t('td', null, m(i.percent), 1), t('td', ot, m(o.$filters.date(i.due_date)), 1), t('td', null, [i.is_enabled ? (l(), p('div', st, dt)) : (l(), p('div', it, lt))]), t('td', null, [t('div', pt, [t('button', { class: 'btn btn-outline-dark btn-sm', onClick: v(M => a.openCouponModal(!1, i), ['prevent']) }, ' 編輯 ', 8, ut)])])]))), 128))])]), b($, { ref: 'couponModal', coupon: s.tempCoupon, onUpdateCoupon: a.updateCoupon }, null, 8, ['coupon', 'onUpdateCoupon'])], 64) } const bt = y(W, [['render', ct]]); export { bt as default }
